# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Smart Counter

## üìä –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –í–∏–¥–µ–æ     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. Preprocessing‚îÇ  ‚Üê –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, resize –∫–∞–¥—Ä–æ–≤
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. Detection   ‚îÇ  ‚Üê YOLOv8 –Ω–∞—Ö–æ–¥–∏—Ç –ª—é–¥–µ–π (bounding boxes)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. Tracking    ‚îÇ  ‚Üê –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç ID, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. Counting    ‚îÇ  ‚Üê –°—á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ª–∏–Ω–∏–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. Visualization‚îÇ  ‚Üê –†–∏—Å—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. **Preprocessing (–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞)**

**–ó–∞–¥–∞—á–∞:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

- –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ (OpenCV)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–¥—Ä–æ–≤ (resize)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FPS (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∫–∞–¥—Ä—ã)

**–í—Ö–æ–¥—ã:** –í–∏–¥–µ–æ—Ñ–∞–π–ª
**–í—ã—Ö–æ–¥—ã:** –ö–∞–¥—Ä—ã (numpy arrays)

---

### 2. **Detection (–î–µ—Ç–µ–∫—Ü–∏—è)**

**–ó–∞–¥–∞—á–∞:** –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ª—é–¥–µ–π –Ω–∞ –∫–∞–¥—Ä–µ

- YOLOv8 –º–æ–¥–µ–ª—å
- –ù–∞ –≤—Ö–æ–¥: –∫–∞–¥—Ä (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
- –ù–∞ –≤—ã—Ö–æ–¥: —Å–ø–∏—Å–æ–∫ bounding boxes

**Bounding Box —Å–æ–¥–µ—Ä–∂–∏—Ç:**

- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: `(x1, y1, x2, y2)`
- Confidence: —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (0.0 - 1.0)
- Class: –∫–ª–∞—Å—Å –æ–±—ä–µ–∫—Ç–∞ (0 = person)

---

### 3. **Tracking (–¢—Ä–µ–∫–∏–Ω–≥)**

**–ó–∞–¥–∞—á–∞:** –û—Ç—Å–ª–µ–¥–∏—Ç—å –∫—Ç–æ –µ—Å—Ç—å –∫—Ç–æ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏

–ü—Ä–æ–±–ª–µ–º–∞: –ù–∞ –∫–∞–¥—Ä–µ N —É –Ω–∞—Å 5 —á–µ–ª–æ–≤–µ–∫, –Ω–∞ –∫–∞–¥—Ä–µ N+1 —Ç–æ–∂–µ 5 —á–µ–ª–æ–≤–µ–∫.
–í–æ–ø—Ä–æ—Å: –≠—Ç–æ —Ç–µ –∂–µ —Å–∞–º—ã–µ –ª—é–¥–∏ –∏–ª–∏ –¥—Ä—É–≥–∏–µ?

**–†–µ—à–µ–Ω–∏–µ:** –ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ç—Ä–µ–∫–∏–Ω–≥–∞ (BoTSORT, ByteTrack, DeepSORT)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç bbox –Ω–∞ –∫–∞–¥—Ä–µ N –∏ N+1
2. –ï—Å–ª–∏ bbox —Å–º–µ—Å—Ç–∏–ª—Å—è —á—É—Ç—å-—á—É—Ç—å ‚Üí —ç—Ç–æ —Ç–æ—Ç –∂–µ —á–µ–ª–æ–≤–µ–∫
3. –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–∞–∂–¥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É
4. –í–µ–¥—ë—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–≤–∏–∂–µ–Ω–∏—è

**Track —Å–æ–¥–µ—Ä–∂–∏—Ç:**

- `track_id`: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä (1, 2, 3...)
- `bbox`: —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- `history`: —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
- `age`: —Å–∫–æ–ª—å–∫–æ –∫–∞–¥—Ä–æ–≤ —Ç—Ä–µ–∫ –∂–∏–≤—ë—Ç

---

### 4. **Counting (–ü–æ–¥—Å—á—ë—Ç)**

**–ó–∞–¥–∞—á–∞:** –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –ø–µ—Ä–µ—Å–µ–∫–ª–æ –ª–∏–Ω–∏—é

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –†–∏—Å—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞)
2. –°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ü–µ–Ω—Ç—Ä –∫–∞–∂–¥–æ–≥–æ bbox
3. –ï—Å–ª–∏ —Ü–µ–Ω—Ç—Ä –Ω–∞ –∫–∞–¥—Ä–µ N –±—ã–ª **–≤—ã—à–µ** –ª–∏–Ω–∏–∏, –∞ –Ω–∞ N+1 —Å—Ç–∞–ª **–Ω–∏–∂–µ** ‚Üí —á–µ–ª–æ–≤–µ–∫ –ø–µ—Ä–µ—Å—ë–∫ –ª–∏–Ω–∏—é –≤–Ω–∏–∑ (+1 –≤—Ö–æ–¥)
4. –ï—Å–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Üí –ø–µ—Ä–µ—Å—ë–∫ –≤–≤–µ—Ä—Ö (+1 –≤—ã—Ö–æ–¥)

**–í–∞–∂–Ω–æ:** –ù—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, –∫–∞–∫–∏–µ ID —É–∂–µ –ø–æ—Å—á–∏—Ç–∞–ª–∏, —á—Ç–æ–±—ã –Ω–µ —Å—á–∏—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã!

---

### 5. **Visualization (–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)**

**–ó–∞–¥–∞—á–∞:** –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –≤–∏–¥–µ–æ

- Bounding boxes –≤–æ–∫—Ä—É–≥ –ª—é–¥–µ–π
- ID —Ç—Ä–µ–∫–æ–≤
- –õ–∏–Ω–∏—é –ø–æ–¥—Å—á—ë—Ç–∞
- –°—á—ë—Ç—á–∏–∫ (IN/OUT/TOTAL)

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Detection (–æ–¥–Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è)

```python
{
    "bbox": (x1, y1, x2, y2),      # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
    "confidence": 0.85,             # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    "class_id": 0,                  # ID –∫–ª–∞—Å—Å–∞ (0 = person)
    "center": (cx, cy)              # –¶–µ–Ω—Ç—Ä bbox
}
```

### Track (–æ–¥–∏–Ω —Ç—Ä–µ–∫)

```python
{
    "track_id": 1,                  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    "bbox": (x1, y1, x2, y2),      # –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
    "confidence": 0.85,             # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    "history": [(x1,y1), (x2,y2)],  # –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω—Ç—Ä–æ–≤
    "age": 42                       # –°–∫–æ–ª—å–∫–æ –∫–∞–¥—Ä–æ–≤ –∂–∏–≤—ë—Ç
}
```

### CountingLine (–ª–∏–Ω–∏—è –ø–æ–¥—Å—á—ë—Ç–∞)

```python
{
    "position": 0.5,                # 0.5 = –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞
    "orientation": "horizontal",    # horizontal –∏–ª–∏ vertical
    "start": (0, 540),              # –ù–∞—á–∞–ª–æ –ª–∏–Ω–∏–∏
    "end": (1920, 540)              # –ö–æ–Ω–µ—Ü –ª–∏–Ω–∏–∏
}
```

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Data Flow)

```
–ö–∞–¥—Ä (Frame)
    ‚Üì
[Detection] ‚Üí List[Detection]
    ‚Üì
[Tracking] ‚Üí List[Track]
    ‚Üì
[Counting] ‚Üí {"in": 10, "out": 5, "total": 15}
    ‚Üì
[Visualization] ‚Üí Annotated Frame (–∫–∞–¥—Ä —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π)
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ª–∏–Ω–∏–∏

```python
prev_y = –ø—Ä–µ–¥—ã–¥—É—â–∞—è_–ø–æ–∑–∏—Ü–∏—è_—Ü–µ–Ω—Ç—Ä–∞_bbox.y
curr_y = —Ç–µ–∫—É—â–∞—è_–ø–æ–∑–∏—Ü–∏—è_—Ü–µ–Ω—Ç—Ä–∞_bbox.y
line_y = –ø–æ–∑–∏—Ü–∏—è_–ª–∏–Ω–∏–∏.y

if prev_y > line_y and curr_y <= line_y:
    # –ü–µ—Ä–µ—Å—ë–∫ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
    count_down += 1

elif prev_y < line_y and curr_y >= line_y:
    # –ü–µ—Ä–µ—Å—ë–∫ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
    count_up += 1
```

### IoU (Intersection over Union) - –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞

```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è bbox –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏
IoU = –ø–ª–æ—â–∞–¥—å_–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è / –ø–ª–æ—â–∞–¥—å_–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

if IoU > 0.3:
    # –≠—Ç–æ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –æ–±—ä–µ–∫—Ç
    update_track(track_id, new_bbox)
else:
    # –≠—Ç–æ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
    create_new_track()
```

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å:

1. **–°–Ω–∞—á–∞–ª–∞**: –ù–∞—É—á–∏—Å—å –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –∏ —á–∏—Ç–∞—Ç—å –∫–∞–¥—Ä—ã (OpenCV)
2. **–ü–æ—Ç–æ–º**: –ó–∞–ø—É—Å—Ç–∏ YOLO –Ω–∞ –æ–¥–Ω–æ–º –∫–∞–¥—Ä–µ - –ø–æ–ª—É—á–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏
3. **–ó–∞—Ç–µ–º**: –ó–∞–ø—É—Å—Ç–∏ YOLO –Ω–∞ –≤—Å—ë–º –≤–∏–¥–µ–æ - –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π bbox
4. **–î–∞–ª—å—à–µ**: –î–æ–±–∞–≤—å —Ç—Ä–µ–∫–∏–Ω–≥ (–º–æ–∂–Ω–æ –≤–∑—è—Ç—å –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É)
5. **–ù–∞–∫–æ–Ω–µ—Ü**: –î–æ–±–∞–≤—å –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á—ë—Ç–∞

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:

‚ùå –°—á–∏—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π bbox –æ—Ç–¥–µ–ª—å–Ω–æ (–±–µ–∑ —Ç—Ä–µ–∫–∏–Ω–≥–∞) ‚Üí –±—É–¥–µ—à—å —Å—á–∏—Ç–∞—Ç—å –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ 100 —Ä–∞–∑
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å track_id –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ ‚Üí –∫–∞–∂–¥—ã–π —á–µ–ª–æ–≤–µ–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è 1 —Ä–∞–∑

‚ùå –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å bbox –Ω–∞–ø—Ä—è–º—É—é –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ ‚Üí –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã (BoTSORT, ByteTrack)

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

–°–º. [TECH_STACK.md](TECH_STACK.md) –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ —Å—Å—ã–ª–æ–∫
