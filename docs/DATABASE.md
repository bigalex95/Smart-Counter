# –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (SQLite) üìä

## –û–ø–∏—Å–∞–Ω–∏–µ

Smart Counter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–¥—Å—á–µ—Ç–∞ –ª—é–¥–µ–π. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª `logs/analytics.db`.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¢–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE people_count (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    count INTEGER NOT NULL
);
```

### –ü–æ–ª—è:

- **id** - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
- **timestamp** - –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- **count** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –ª—é–¥–µ–π

## –õ–æ–≥–∏–∫–∞ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Å—á–µ—Ç—á–∏–∫–∞**. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (30+ –∑–∞–ø–∏—Å–µ–π –≤ —Å–µ–∫—É–Ω–¥—É) –∏ —ç–∫–æ–Ω–æ–º–∏—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ.

```cpp
// –ü—Ä–∏–º–µ—Ä –∏–∑ main.cpp
if (current_count > last_saved_count) {
    db.insert_log(current_count);
    last_saved_count = current_count;
    std::cout << "üì¶ Data saved to DB: " << current_count << std::endl;
}
```

## Docker Volume –¥–ª—è –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–±–ª–µ–º–∞

–ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –æ–Ω–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º Docker Volume –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–ø–∫–∏ `logs` –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—É:

```bash
docker run -it --rm \
    --gpus all \
    -v $(pwd)/logs:/app/logs \
    smart-counter-cpp
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Å deploy.sh

–°–∫—Ä–∏–ø—Ç `scripts/deploy.sh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç —Ç–æ–º:

```bash
# –ó–∞–ø—É—Å–∫ —Å GPU –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ë–î
./scripts/deploy.sh run --gpu

# –ò–ª–∏ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
./scripts/deploy.sh run --input video.mp4 --gpu
```

## –ü—Ä–æ—Å–º–æ—Ç—Ä –î–∞–Ω–Ω—ã—Ö

### 1. –ß–µ—Ä–µ–∑ SQLite CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
sudo apt install sqlite3

# –û—Ç–∫—Ä—ã—Ç—å –±–∞–∑—É
sqlite3 logs/analytics.db

# SQL –∫–æ–º–∞–Ω–¥—ã
sqlite> .tables
sqlite> SELECT * FROM people_count LIMIT 10;
sqlite> SELECT COUNT(*) FROM people_count;
sqlite> SELECT * FROM people_count ORDER BY timestamp DESC LIMIT 5;
```

### 2. –ß–µ—Ä–µ–∑ DB Browser for SQLite (GUI)

1. –°–∫–∞—á–∞—Ç—å: https://sqlitebrowser.org/
2. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `logs/analytics.db`
3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. –ß–µ—Ä–µ–∑ Python

```python
import sqlite3
import pandas as pd

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
conn = sqlite3.connect('logs/analytics.db')

# –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
df = pd.read_sql_query("SELECT * FROM people_count", conn)
print(df)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
print(f"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {len(df)}")
print(f"–ú–∞–∫—Å–∏–º—É–º –ª—é–¥–µ–π: {df['count'].max()}")
print(f"–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: {df['count'].mean():.2f}")

conn.close()
```

## –ü—Ä–∏–º–µ—Ä—ã SQL –ó–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π

```sql
SELECT * FROM people_count
ORDER BY timestamp DESC
LIMIT 10;
```

### –°—Ä–µ–¥–Ω–∏–π —Å—á–µ—Ç—á–∏–∫ –∑–∞ –¥–µ–Ω—å

```sql
SELECT DATE(timestamp) as date, AVG(count) as avg_count
FROM people_count
GROUP BY DATE(timestamp);
```

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞

```sql
SELECT MAX(count) as max_count, timestamp
FROM people_count;
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å

```sql
SELECT * FROM people_count
WHERE timestamp >= datetime('now', '-1 hour')
ORDER BY timestamp;
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ö–æ–¥

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
#include "database.h"

// –í main.cpp
Database db("logs/analytics.db");
db.init();  // –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
```

### –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö

```cpp
int people_count = 42;
db.insert_log(people_count);
```

## –û—á–∏—Å—Ç–∫–∞ –ë–∞–∑—ã

```bash
# –£–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
rm logs/analytics.db

# –ò–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É (—á–µ—Ä–µ–∑ sqlite3)
sqlite3 logs/analytics.db "DELETE FROM people_count;"
```

## Troubleshooting

### –ë–∞–∑–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞–ø–∫–∞ `logs/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: `chmod 755 logs/`
3. –í Docker –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: `docker inspect <container_id> | grep Mounts -A 10`

### –ë–∞–∑–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è volume: `-v $(pwd)/logs:/app/logs`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É—Ç—å —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ SQLite3 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–ª–∏–Ω–∫–æ–≤–∞–Ω–∞ –≤ CMakeLists.txt

## –î–∞–ª—å–Ω–µ–π—à–∏–µ –£–ª—É—á—à–µ–Ω–∏—è

1. **Prepared Statements** - –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
2. **Batch Insert** - –≥—Ä—É–ø–ø–æ–≤–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. **–ò–Ω–¥–µ–∫—Å—ã** - –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **API endpoint** - REST API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
6. **–î–∞—à–±–æ—Ä–¥** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –§–∞–π–ª—ã

- `include/database.h` - –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª –∫–ª–∞—Å—Å–∞ Database
- `src/database.cpp` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ Database
- `src/main.cpp` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ë–î –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
- `CMakeLists.txt` - –ª–∏–Ω–∫–æ–≤–∫–∞ SQLite3
- `Dockerfile` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ libsqlite3-dev

## –ü—Ä–∏–º–µ—Ä –†–∞–±–æ—Ç—ã

```bash
# 1. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t smart-counter-cpp .

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º logs
docker run -it --rm \
    --gpus all \
    -v $(pwd)/logs:/app/logs \
    smart-counter-cpp

# 3. –ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É
sqlite3 logs/analytics.db "SELECT COUNT(*) FROM people_count;"

# 4. –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
sqlite3 -header -csv logs/analytics.db "SELECT * FROM people_count;" > analytics_export.csv
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

SQLite –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Edge-—É—Å—Ç—Ä–æ–π—Å—Ç–≤:

- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è (ACID-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è)
- ‚úÖ –õ–µ–≥–∫–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ C++
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQL –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
