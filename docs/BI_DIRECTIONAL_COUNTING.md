# –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç (Bi-directional Counting)

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ Smart Counter —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç** ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –ª—é–¥–µ–π —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é –ø–æ–¥—Å—á–µ—Ç–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

- üëá **IN** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π, –≤–æ—à–µ–¥—à–∏—Ö (–¥–≤–∏–∂–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)
- üëÜ **OUT** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π, –≤—ã—à–µ–¥—à–∏—Ö (–¥–≤–∏–∂–µ–Ω–∏–µ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
- üè¢ **INSIDE** ‚Äî —Ç–µ–∫—É—â–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å (—Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É IN –∏ OUT)

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –¢—Ä–µ–∫–µ—Ä (`tracker.h` / `tracker.cpp`)

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `previous_center` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `TrackedObject`:

```cpp
struct TrackedObject {
    int id;
    cv::Point center;
    cv::Point previous_center; // –ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    cv::Rect box;
    int frames_since_seen;
};
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –µ–≥–æ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –Ω–æ–≤–æ–π
- –î–ª—è –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ `previous_center` = `center` (–∏–∑–±–µ–≥–∞–µ–º –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)

### 2. –õ–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ (`main.cpp`)

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ª–∏–Ω–∏–∏:

```cpp
// –£—Å–ª–æ–≤–∏–µ 1: –°–µ–π—á–∞—Å –Ω–∏–∂–µ –ª–∏–Ω–∏–∏, –±—ã–ª –≤—ã—à–µ (–í–•–û–î / DOWN)
if (obj.previous_center.y < line_y && obj.center.y >= line_y) {
    count_in++;
    // –ó–µ–ª–µ–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ –ª–∏–Ω–∏–∏
}

// –£—Å–ª–æ–≤–∏–µ 2: –°–µ–π—á–∞—Å –≤—ã—à–µ –ª–∏–Ω–∏–∏, –±—ã–ª –Ω–∏–∂–µ (–í–´–•–û–î / UP)
if (obj.previous_center.y > line_y && obj.center.y <= line_y) {
    count_out++;
    // –ö—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ –ª–∏–Ω–∏–∏
}
```

**–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:**

- üü¢ –ó–µ–ª–µ–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ –ª–∏–Ω–∏–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ
- üî¥ –ö—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ –ª–∏–Ω–∏–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
- üü° –ñ–µ–ª—Ç–∞—è –ª–∏–Ω–∏—è –≤ —Å–ø–æ–∫–æ–π–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (`database.h` / `database.cpp`)

–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE IF NOT EXISTS people_count (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    in_count INTEGER NOT NULL,
    out_count INTEGER NOT NULL
);
```

**–ú–µ—Ç–æ–¥ –∑–∞–ø–∏—Å–∏:**

```cpp
void Database::insert_log(int in_count, int out_count)
```

### 4. Python –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### `read_database.py`

–û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫:

- Total IN / OUT
- Average Occupancy
- Current Inside
- –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV —Å –ø–æ–ª–µ–º occupancy

#### `dashboard/app.py`

–ù–æ–≤—ã–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:

- üìä Traffic Flow ‚Äî –∑–µ–ª–µ–Ω–∞—è (IN) –∏ –∫—Ä–∞—Å–Ω–∞—è (OUT) –ª–∏–Ω–∏–∏
- üë• Occupancy Over Time ‚Äî —Å–∏–Ω—è—è –æ–±–ª–∞—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏: IN, OUT, INSIDE, Last Update

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
./build/SmartCounter --input video.mp4
```

### –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î

```bash
python3 python/read_database.py --db logs/analytics.db
```

### –ó–∞–ø—É—Å–∫ –¥–∞—à–±–æ—Ä–¥–∞

```bash
cd dashboard
streamlit run app.py -- --db ../logs/analytics.db
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–ø–∏—Å–∏ –≤ –ë–î:

```
id | timestamp           | in_count | out_count | occupancy
---+--------------------+----------+-----------+----------
1  | 2025-12-04 10:33:08 | 1        | 0         | 1
2  | 2025-12-04 10:33:12 | 1        | 1         | 0
3  | 2025-12-04 10:33:44 | 2        | 1         | 1
4  | 2025-12-04 10:33:45 | 2        | 2         | 0
```

### –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
Frame 60 ‚Äî Avg FPS: 42.5, Instant FPS: 55.5, IN: 3, OUT: 4, INSIDE: -1
üì¶ Data saved to DB: IN=3 OUT=4
```

## üéØ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç Y:

| –°–æ—Å—Ç–æ—è–Ω–∏–µ                             | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ      |
| ------------------------------------- | ----------- | ------------- |
| `prev.y < line_y && curr.y >= line_y` | ‚¨áÔ∏è –í–Ω–∏–∑     | `count_in++`  |
| `prev.y > line_y && curr.y <= line_y` | ‚¨ÜÔ∏è –í–≤–µ—Ä—Ö    | `count_out++` |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ú–∏–Ω–∏–º—É–º –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í–∞–∂–Ω–æ:** –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö **–Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞** —Å–æ —Å—Ç–∞—Ä–æ–π!

–£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```bash
rm logs/analytics.db
```

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è –Ω–æ–≤–∞—è –±–∞–∑–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

## üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IN: 10         [–ó–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç]  ‚îÇ
‚îÇ OUT: 8         [–ö—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç]  ‚îÇ
‚îÇ INSIDE: 2      [–ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê [–ñ–µ–ª—Ç–∞—è –ª–∏–Ω–∏—è] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   (–í—Å–ø—ã—Ö–∏–≤–∞–µ—Ç –∑–µ–ª–µ–Ω—ã–º –ø—Ä–∏ –≤—Ö–æ–¥–µ,
    –∫—Ä–∞—Å–Ω—ã–º –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ)
```

## üìà –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. **–ó–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑** ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏–Ω–∏–π –ø–æ–¥—Å—á–µ—Ç–∞
2. **–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π –¥–≤–∏–∂–µ–Ω–∏—è
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏** ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è
4. **–û–ø–æ–≤–µ—â–µ–Ω–∏—è** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏
5. **ML-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞

## üêõ –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫–∏ –≤–µ–¥—É—Ç —Å–µ–±—è —Å—Ç—Ä–∞–Ω–Ω–æ:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∏—Ü–∏—é –ª–∏–Ω–∏–∏ (`line_y`)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç—Ä–µ–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ `counted_ids` ‚Äî ID –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## üìù Changelog

### v2.0 - Bi-directional Counting

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `previous_center` –≤ `TrackedObject`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (in_count, out_count)
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (—Ü–≤–µ—Ç–Ω—ã–µ –≤—Å–ø—ã—à–∫–∏ –ª–∏–Ω–∏–∏)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã Python —Å–∫—Ä–∏–ø—Ç—ã –∏ –¥–∞—à–±–æ—Ä–¥
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∞ INSIDE (occupancy) –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
